# MiniSocial 実装計画書

**作成日**: 2025年12月27日
**基準ドキュメント**: RDdoc.md

---

## 目次

1. [Phase 1: MVP（投稿CRUD + いいね）](#phase-1-mvp)
2. [Phase 2: 投稿編集機能](#phase-2-投稿編集機能)
3. [Phase 3: コメント機能](#phase-3-コメント機能)
4. [Phase 4: 認証機能](#phase-4-認証機能)

---

## Phase 1: MVP ✅ 完了

### 1.1 環境構築

#### 1.1.1 プロジェクト初期化
- [x] Next.js 15プロジェクトの作成（App Router、TypeScript、Tailwind CSS）
- [x] 必要なパッケージのインストール（Supabaseクライアント等）
- [x] ディレクトリ構造の整備

#### 1.1.2 Supabase設定
- [x] Supabaseプロジェクトの作成（ユーザー作業）
- [x] 環境変数テンプレートの作成（`.env.local.example`）
- [x] `.gitignore`に`.env.local`を追加（デフォルトで含まれている）
- [x] Supabaseクライアントの初期化ファイル作成（`src/lib/supabase.ts`）

#### 1.1.3 データベース構築
- [x] `posts`テーブルのSQL作成
- [x] `likes`テーブルのSQL作成
- [x] サンプルデータのSQL作成
- [x] Supabaseダッシュボードでの実行（ユーザー作業）

---

### 1.2 API Routes

#### 1.2.1 GET /api/posts - 投稿一覧取得
- [x] エンドポイントの作成
- [x] Supabaseからの投稿取得（いいね数含む）
- [x] 新しい順でソート
- [x] エラーハンドリング（500エラー）

#### 1.2.2 POST /api/posts - 投稿作成
- [x] エンドポイントの作成
- [x] リクエストボディのパース
- [x] バリデーション実装
  - [x] `content`未送信/null → 400
  - [x] 空文字/空白のみ → 400
  - [x] 280文字超過 → 400
  - [x] 文字列以外 → 400
- [x] データベースへの保存
- [x] 201レスポンスの返却
- [x] エラーハンドリング

#### 1.2.3 DELETE /api/posts/[id] - 投稿削除
- [x] 動的ルートの作成
- [x] パスパラメータの取得
- [x] バリデーション実装
  - [x] 数値以外/負の数 → 400
  - [x] 存在しない投稿 → 404
- [x] データベースからの削除
- [x] 200レスポンスの返却
- [x] エラーハンドリング

#### 1.2.4 POST /api/posts/[id]/like - いいね追加
- [x] 動的ルートの作成
- [x] パスパラメータの取得
- [x] バリデーション実装
  - [x] 数値以外/負の数 → 400
  - [x] 存在しない投稿 → 404
- [x] いいねのデータベース保存
- [x] 更新後のいいね数取得
- [x] 201レスポンスの返却
- [x] エラーハンドリング

---

### 1.3 フロントエンド

#### 1.3.1 型定義
- [x] `Post`型の定義（id, content, created_at, like_count）
- [x] APIレスポンス型の定義

#### 1.3.2 ホームページ（`/`）
- [x] ページコンポーネントの作成
- [x] レイアウトの設計（ヘッダー、メインコンテンツ）

#### 1.3.3 投稿フォームコンポーネント
- [x] テキストエリアの実装
  - [x] プレースホルダー：「今何してる？」
  - [x] 複数行入力対応
- [x] 文字数カウント表示
- [x] 投稿ボタンの実装
  - [x] 無効条件：空文字/280文字超過
- [x] フロントエンドバリデーション
- [x] API呼び出し（POST /api/posts）
- [x] 成功時：一覧更新、フォームクリア
- [x] エラー時：エラーメッセージ表示

#### 1.3.4 投稿一覧コンポーネント
- [x] 投稿データの取得（useEffect + fetch）
- [x] ローディング状態の表示
- [x] 空状態の表示（「まだ投稿がありません...」）
- [x] 投稿カードの繰り返し表示

#### 1.3.5 投稿カードコンポーネント
- [x] 投稿内容の表示（改行保持）
- [x] 投稿日時の表示（YYYY年MM月DD日 HH:MM形式）
- [x] いいね数の表示
- [x] いいねボタンの実装
  - [x] アイコン切り替え（♡ / ❤️）
  - [x] 連打防止
  - [x] API呼び出し（POST /api/posts/[id]/like）
  - [x] いいね数の即時更新
- [x] 削除ボタンの実装
  - [x] 確認ダイアログ
  - [x] API呼び出し（DELETE /api/posts/[id]）
  - [x] 一覧からの即時削除

#### 1.3.6 スタイリング（Tailwind CSS）
- [x] レスポンシブデザイン
- [x] 投稿カードのスタイル
- [x] ボタンのホバー/アクティブ状態
- [x] エラーメッセージのスタイル
- [x] ローディング表示

---

### 1.4 学習できる項目

**Web基礎**
- クライアントとサーバーの役割
- リクエストとレスポンスの流れ
- GET、POST、DELETEの違い
- 200、400、404、500の意味
- DevToolsでのNetwork確認

**フロントエンド**
- React コンポーネント、Props、State
- useState、useEffect、依存配列
- Next.js App Router、ファイルベースルーティング
- Tailwind CSS

**バックエンド**
- API、REST、エンドポイント
- CRUDとHTTPメソッドの対応
- API Routes（route.ts）

**データベース**
- RDB、テーブル、カラム、レコード
- 主キー、外部キー
- SELECT、INSERT、DELETE

**セキュリティ**
- 環境変数管理（.env.local）

---

## Phase 2: 投稿編集機能

### 2.1 バックエンド
- [ ] PUT /api/posts/[id] エンドポイントの作成
- [ ] バリデーション（Phase 1と同様）
- [ ] UPDATE SQL文の実装
- [ ] `updated_at`の更新

### 2.2 フロントエンド
- [ ] 編集ボタンの追加
- [ ] 編集モードの実装
- [ ] 編集フォームの実装
- [ ] キャンセル機能
- [ ] 保存時のAPI呼び出し
- [ ] 一覧の即時更新

### 2.3 学習できる項目
- PUT メソッドの理解
- UPDATE文の習得

---

## Phase 3: コメント機能

### 3.1 データベース
- [ ] `comments`テーブルの作成
  ```sql
  CREATE TABLE comments (
    id SERIAL PRIMARY KEY,
    post_id INTEGER NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  ```

### 3.2 バックエンド
- [ ] GET /api/posts/[id]/comments - コメント一覧取得
- [ ] POST /api/posts/[id]/comments - コメント作成
- [ ] DELETE /api/comments/[id] - コメント削除

### 3.3 フロントエンド
- [ ] 投稿詳細ページ（`/posts/[id]`）の作成
- [ ] Linkコンポーネントでページ遷移
- [ ] コメント一覧表示
- [ ] コメント投稿フォーム
- [ ] コメント削除機能

### 3.4 学習できる項目
- テーブルのリレーション（外部キー）
- 動的ルーティング（`[id]`）
- Linkコンポーネントでのページ遷移

---

## Phase 4: 認証機能

### 4.1 データベース
- [ ] `users`テーブルの作成
- [ ] 既存テーブルに`user_id`カラム追加
- [ ] 外部キー制約の設定

### 4.2 バックエンド
- [ ] Supabase Auth の導入
- [ ] POST /api/auth/signup - ユーザー登録
- [ ] POST /api/auth/login - ログイン
- [ ] POST /api/auth/logout - ログアウト
- [ ] セッション管理（Cookie）
- [ ] 認可チェック（自分の投稿のみ削除可能 → 403エラー）

### 4.3 フロントエンド
- [ ] ログインページ（`/login`）
- [ ] サインアップページ（`/signup`）
- [ ] 認証状態の管理（Context）
- [ ] ヘッダーにログイン/ログアウトボタン
- [ ] 投稿者名の表示
- [ ] 認可によるUI制御（自分の投稿のみ削除ボタン表示）

### 4.4 学習できる項目
- Cookieとは何か
- Sessionとは何か
- なぜCookie/Sessionが必要か
- ログイン状態がどのように維持されるか
- 認証と認可の違い
- 401（未認証）と403（権限なし）の違い

---

## 実装優先順位

| 優先度 | 項目 | フェーズ | ステータス |
|--------|------|---------|-----------|
| 1 | 環境構築 | Phase 1 | ✅ 完了 |
| 2 | データベース構築 | Phase 1 | ✅ 完了 |
| 3 | API実装（CRUD） | Phase 1 | ✅ 完了 |
| 4 | フロントエンド実装 | Phase 1 | ✅ 完了 |
| 5 | 動作確認・テスト | Phase 1 | ✅ 完了 |
| 6 | 投稿編集機能 | Phase 2 | 🔵 未着手 |
| 7 | コメント機能 | Phase 3 | 🔵 未着手 |
| 8 | 認証機能 | Phase 4 | 🔵 未着手 |

---

## 技術的な注意事項

### セキュリティ
- 環境変数は`.env.local`で管理、`.gitignore`に追加必須
- SQLインジェクション対策：パラメータ化クエリを使用
- XSS対策：Reactのデフォルトエスケープを使用
- `dangerouslySetInnerHTML`は使用禁止

### コーディング規約
- TypeScriptで型安全に実装
- コンポーネントは機能ごとに分割
- API Routesはエラーハンドリングを徹底
- 適切なHTTPステータスコードを返却

---

**ドキュメント終了**
